//*********************************************************************
var w=window.innerWidth,h=window.innerHeight,state=0,imageSize=500,boundaryPct=.25,outerBoundary=imageSize*3/4,horizBoundary=6400,vertBoundary=3600,userPosition=document.getElementById("user-position"),HUD=document.getElementById("HUD"),bMap=!0,panMaxSpeed=10,mouse=new THREE.Vector2,mouseDown=0,mouseDownCount=0,bIsFront=!0,bTextboxActive=!1,selectedImage=-1,selectedImagePos=new THREE.Vector3;selectedImagePos.set(0,0,0);var ray=new THREE.Ray,projector=new THREE.Projector,directionVector=new THREE.Vector3,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH=window.innerWidth,moveInfo={x:0,y:0},INTERSECTED,pickMouse=new THREE.Vector2,pickProjector=new THREE.Projector,pickRaycaster=new THREE.Raycaster,renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(w,h);renderer.setClearColorHex(131586,1);renderer.clear();var container=document.getElementById("container");container.appendChild(renderer.domElement);var FOV=45,ASPECT=w/h,NEAR=1,FAR=5e4,camera=new THREE.PerspectiveCamera(FOV,ASPECT,NEAR,FAR);camera.position.z=1200;camera.position.y=0;camera.position.x=0;var prevCamX=camera.position.x,prevCamY=camera.position.y,prevCamZ=camera.position.z,camSpeedX=0,camSpeedY=0,scene=new THREE.Scene,light=new THREE.SpotLight(15261886,1,1e4,Math.PI/4,10);scene.add(light);var clickedLight=new THREE.SpotLight(15261886,0,1e4,Math.PI/6,18);scene.add(clickedLight);var hemiLight=new THREE.HemisphereLight(16777215,16777215,1),lookAtThisGeom=new THREE.Geometry(100,100,10,10),lookAtThisText=new THREE.MeshLambertMaterial({color:16711680,transparent:!0}),lookAtThis=new THREE.Mesh(lookAtThisGeom,lookAtThisText);scene.add(lookAtThis);var prevLookAtThis=new THREE.Vector3;renderer.shadowMapEnabled=!0;light.castShadow=!0;var metaPlaneGeo=new THREE.PlaneGeometry(imageSize,imageSize,10,10),metaPlaneTexture=THREE.ImageUtils.loadTexture("instagram_img/paper-back.jpg"),metaPlaneBump=THREE.ImageUtils.loadTexture("instagram_img/paper-back-bump.jpg"),metaPlaneMat=new THREE.MeshPhongMaterial({map:metaPlaneTexture,bumpMap:metaPlaneBump,bumpScale:1}),metaPlane=new THREE.Mesh(metaPlaneGeo,metaPlaneMat);metaPlane.rotation.y=Math.PI;scene.add(metaPlane);var metaDataText_name="Hello, World!",metaCanvas_name=document.createElement("canvas");metaCanvas_name.width=500;metaCanvas_name.height=500;var metaContext_name=metaCanvas_name.getContext("2d");metaContext_name.font="36px Font";metaContext_name.fillStyle="rgba(40,40,40,0.9)";metaContext_name.fillText(metaDataText_name,0,50);var metaDataTexture_name=new THREE.Texture(metaCanvas_name);metaDataTexture_name.needsUpdate=!0;var metaDataMat_name=new THREE.MeshPhongMaterial({map:metaDataTexture_name});metaDataMat_name.transparent=!0;var metaData_name=new THREE.Mesh(new THREE.PlaneGeometry(metaCanvas_name.width,metaCanvas_name.height),metaDataMat_name);metaData_name.position.set(0,0,10);metaData_name.rotation.y=Math.PI;scene.add(metaData_name);var metaDataText_date="Hello, World!",metaCanvas_date=document.createElement("canvas");metaCanvas_date.width=500;metaCanvas_date.height=500;var metaContext_date=metaCanvas_date.getContext("2d");metaContext_date.font="24px Font";metaContext_date.fillStyle="rgba(40,40,40,0.9)";metaContext_date.fillText(metaDataText_date,0,50);var metaDataTexture_date=new THREE.Texture(metaCanvas_date);metaDataTexture_date.needsUpdate=!0;var metaDataMat_date=new THREE.MeshPhongMaterial({map:metaDataTexture_date});metaDataMat_date.transparent=!0;var metaData_date=new THREE.Mesh(new THREE.PlaneGeometry(metaCanvas_date.width,metaCanvas_date.height),metaDataMat_date);metaData_date.position.set(0,0,10);metaData_date.rotation.y=Math.PI;scene.add(metaData_date);var metaDataText_caption="Hello, World!",metaCanvas_caption=document.createElement("canvas");metaCanvas_caption.width=500;metaCanvas_caption.height=500;var metaContext_caption=metaCanvas_caption.getContext("2d");metaContext_caption.font="28px Font";metaContext_caption.fillStyle="rgba(40,40,40,0.9)";metaContext_caption.fillText(metaDataText_caption,0,50);var metaDataTexture_caption=new THREE.Texture(metaCanvas_caption);metaDataTexture_caption.needsUpdate=!0;var metaDataMat_caption=new THREE.MeshPhongMaterial({map:metaDataTexture_caption});metaDataMat_caption.transparent=!0;var metaData_caption=new THREE.Mesh(new THREE.PlaneGeometry(metaCanvas_caption.width,metaCanvas_caption.height),metaDataMat_caption);metaData_caption.position.set(0,0,10);metaData_caption.rotation.y=Math.PI;scene.add(metaData_caption);window.onload=function(){function T(){e=F(camera.position.z,1e3,4500,500,2e3);var t=lookAtThis.position.x,n=lookAtThis.position.y;while(lineLength(lookAtThis.position.x,lookAtThis.position.y,t,n)<e){t=camera.position.x+Math.cos(Math.random()*Math.PI*2)*e;n=camera.position.y+Math.sin(Math.random()*Math.PI*2)*e}var r=Math.random()*10,i=Math.random()*(Math.PI/2)-Math.PI/4,s=new THREE.PlaneGeometry(imageSize,imageSize,10,10),o=new THREE.MeshLambertMaterial({color:16777215}),u=Math.floor(Math.random()*photoLinks.length),f=THREE.ImageUtils.loadTexture("instagram_img/"+photoLinks[u].link+".jpg"),l=Math.floor(Math.random()*5),c=THREE.ImageUtils.loadTexture("instagram_img/texture_"+l+".jpg"),h=new THREE.MeshPhongMaterial({map:f,bumpMap:c,bumpScale:5}),p=new THREE.Mesh(s,h);p.position.x=t;p.position.y=n;p.position.z=r;p.rotation.z=i;a.push(p);scene.add(a[a.length-1])}function N(){t=F(camera.position.z,1e3,4500,1e3,3e3);for(var e=0;e<a.length;e++){var n=lineLength(a[e].position.x,a[e].position.y,camera.position.x,camera.position.y);if(n>t){scene.remove(a[e]);a.splice(e,1)}}}function C(){if(o!=moveInfo.x||u!=moveInfo.y){o=moveInfo.x;u=moveInfo.y;s=F(camera.position.z,1e3,4500,1200,1400);for(var e=0;e<a.length;e++){var t=lineLength(a[e].position.x,a[e].position.y,lookAtThis.position.x,lookAtThis.position.y);if(t<s&&t>s/2){var n=Math.floor(Math.random()*31),r=THREE.ImageUtils.loadTexture("img/instagram_"+n+".jpg");a[e].material.map=r}}}window.setTimeout(C,2e3)}function k(e){for(var t=0;t<a.length;t++)if(a[t].id==e){selectedImage=t;selectedImagePos.set(a[t].position.x,a[t].position.y,a[t].position.z);a[t].position.set(camera.position.x,camera.position.y,camera.position.z-800);a[t].rotation.set(0,0,0);metaPlane.position.set(camera.position.x,camera.position.y,camera.position.z-800);metaData_name.position.set(camera.position.x,camera.position.y,camera.position.z-799.9);metaData_date.position.set(camera.position.x,camera.position.y,camera.position.z-799.9);metaData_caption.position.set(camera.position.x,camera.position.y,camera.position.z-799.9);light.intensity=0;clickedLight.intensity=1;clickedLight.position.set(camera.position.x,camera.position.y,1e3);clickedLight.target=lookAtThis;a[t].material.needsUpdate=!0;state=1;metaDataText_name=photoLinks[selectedImage].name;metaContext_name.save();metaContext_name.setTransform(1,0,0,1,0,0);metaContext_name.clearRect(0,0,metaCanvas_name.width,metaCanvas_name.height);metaContext_name.restore();metaContext_name.fillText(metaDataText_name,j(20,30),j(145,155));metaDataTexture_name.needsUpdate=!0;metaDataText_date=photoLinks[selectedImage].time;metaContext_date.save();metaContext_date.setTransform(1,0,0,1,0,0);metaContext_date.clearRect(0,0,metaCanvas_date.width,metaCanvas_date.height);metaContext_date.restore();metaContext_date.fillText(metaDataText_date,j(20,30),j(110,120));metaDataTexture_date.needsUpdate=!0;metaDataText_caption=photoLinks[selectedImage].caption;metaDataText_caption=="n"&&(metaDataText_caption="");var n=metaContext_caption.measureText(metaDataText_caption),r=n.width;metaContext_caption.save();metaContext_caption.setTransform(1,0,0,1,0,0);metaContext_caption.clearRect(0,0,metaCanvas_caption.width,metaCanvas_caption.height);metaContext_caption.restore();I(metaContext_caption,metaDataText_caption,j(20,30),j(200,220),400,32);metaDataTexture_caption.needsUpdate=!0}}function L(e,t){if(e<w/2-outerBoundary||e>w/2+outerBoundary||t<h/2-outerBoundary||t>h/2+outerBoundary){state=0;metaPlane.rotation.y=Math.PI;metaData_name.rotation.y=Math.PI;metaData_date.rotation.y=Math.PI;metaData_caption.rotation.y=Math.PI;light.intensity=1;clickedLight.intensity=0;a[selectedImage].position.set(selectedImagePos.x,selectedImagePos.y,selectedImagePos.z);a[selectedImage].rotation.set(0,0,Math.random()*(Math.PI/2)-Math.PI/4);selectImage=-1;removeTextContainer();clearNotes();textbox.value="";bIsFront=!0}}function A(e,t){var n=Math.abs(w/2-e),r=Math.abs(h/2-t);e<w*boundaryPct?camSpeedX=F(n,w*boundaryPct,w/2,0,-panMaxSpeed):e>w-w*boundaryPct&&(camSpeedX=F(n,w*boundaryPct,w/2,0,panMaxSpeed));t<h*boundaryPct?camSpeedY=F(r,h*boundaryPct,h/2,0,panMaxSpeed):t>h-h*boundaryPct&&(camSpeedY=F(r,h*boundaryPct,h/2,0,-panMaxSpeed))}function O(){var e=moveInfo.x/SCREEN_WIDTH*SCREEN_WIDTH/2-1,t=-(moveInfo.y/SCREEN_HEIGHT)*SCREEN_HEIGHT/2+1;directionVector.set(e,t,.5);projector.unprojectVector(directionVector,camera)}function M(){var e=new THREE.Vector3(pickMouse.x,pickMouse.y,1);pickProjector.unprojectVector(e,camera);pickRaycaster.set(camera.position,e.sub(camera.position).normalize());var t=pickRaycaster.intersectObjects(a);if(t.length>0){INTERSECTED;INTERSECTED=t[0].object}else INTERSECTED=null}function _(){if(INTERSECTED!=null)for(var e=0;e<a.length;e++)if(a[e].id==INTERSECTED.id){a[e].position.x+=lookAtThis.position.x-prevLookAtThis.x;a[e].position.y+=lookAtThis.position.y-prevLookAtThis.y}}function D(){for(var e=0;e<a.length;e++)if(a[e].id==INTERSECTED.id){selectedImage=e;selectedImagePos.set(a[e].position.x,a[e].position.y,a[e].position.z)}}function P(){if(bMap){var e=F(camera.position.x,-horizBoundary,horizBoundary,0,256)-26,t=F(camera.position.y,vertBoundary,-vertBoundary,0,160)-16;userPosition.style.left=e+"px";userPosition.style.top=t+"px";HUD.style.right="10px";HUD.style.bottom="10px"}else{userPosition.style.left="-9999px";userPosition.style.top="-9999px";HUD.style.right="-9999px";HUD.style.bottom="-9999px"}}function H(){document.activeElement.nodeName=="TEXTAREA"||document.activeElement.nodeName=="INPUT"?bTextboxActive=!0:bTextboxActive=!1}function B(e){if(e==0){a[selectedImage].rotation.y=0;metaPlane.rotation.y=Math.PI;metaData_name.rotation.y=Math.PI;metaData_date.rotation.y=Math.PI;metaData_caption.rotation.y=Math.PI}else if(e==1){a[selectedImage].rotation.y=Math.PI;metaPlane.rotation.y=Math.PI*2;metaData_name.rotation.y=Math.PI*2;metaData_date.rotation.y=Math.PI*2;metaData_caption.rotation.y=Math.PI*2}else if(e==2){if(a[selectedImage].rotation.y<0){a[selectedImage].rotation.y+=.3;metaPlane.rotation.y+=.3;metaData_name.rotation.y+=.3;metaData_date.rotation.y+=.3;metaData_caption.rotation.y+=.3}}else if(e==3){if(a[selectedImage].rotation.y>0){a[selectedImage].rotation.y-=.3;metaPlane.rotation.y-=.3;metaData_name.rotation.y-=.3;metaData_date.rotation.y-=.3;metaData_caption.rotation.y-=.3}}else if(e==4){a[selectedImage].rotation.y=0;metaPlane.rotation.y=Math.PI;metaData_name.rotation.y=Math.PI;metaData_date.rotation.y=Math.PI;metaData_caption.rotation.y=Math.PI}}function j(e,t){return Math.floor(Math.random()*(t-e+1))+e}function F(e,t,n,r,i){return r+(i-r)*(e-t)/(n-t)}function I(e,t,n,r,i,s){var o=t.split(" "),u="";for(var a=0;a<o.length;a++){var f=u+o[a]+" ",l=e.measureText(f),c=l.width;if(c>i&&a>0){e.fillText(u,n,r);u=o[a]+" ";r+=s}else u=f}e.fillText(u,n,r)}function q(e){camera.position.z<1e3&&(camera.position.z=1e3);camera.position.z>4500&&(camera.position.z=4500);if(state==0){if(camera.position.x>horizBoundary-w/2){camSpeedX=0;camera.position.x=horizBoundary-w/2}if(camera.position.x<-horizBoundary+w/2){camSpeedX=0;camera.position.x=-horizBoundary+w/2}if(camera.position.y>vertBoundary-h/2){camSpeedY=0;camera.position.y=vertBoundary-h/2}if(camera.position.y<-vertBoundary+h/2){camSpeedY=0;camera.position.y=-vertBoundary+h/2}camera.position.x+=camSpeedX;camera.position.y+=camSpeedY;P();var t=F(camera.position.z,1e3,4500,Math.PI/8,Math.PI/40),n=F(camera.position.z,1e3,4500,75,500);light.angle=t;light.exponent=n;x.position.x=camera.position.x;x.position.y=camera.position.y;light.position.set(camera.position.x,camera.position.y,camera.position.z);light.target=lookAtThis;O();if(mouseDown){_();camSpeedX=0;camSpeedY=0;light.intensity=1.5;light.angle=Math.PI/4;light.exponent=30;mouseDownCount++}r=F(moveInfo.x,0,w,-120,-570);i=F(moveInfo.y,0,h,80,-200);prevLookAtThis.x=lookAtThis.position.x;prevLookAtThis.y=lookAtThis.position.y;prevLookAtThis.z=lookAtThis.position.z;lookAtThis.position.x=directionVector.x-SCREEN_WIDTH/2+r;lookAtThis.position.y=directionVector.y+SCREEN_HEIGHT/2+i;lookAtThis.position.z=directionVector.z-1e3}else if(state==1){lookAtThis.position.set(camera.position.x,camera.position.y,camera.position.z-1e3);H();if(bIsFront)if(mouse.x>w/2+imageSize/3&&mouse.x<w/2+outerBoundary){if(a[selectedImage].rotation.y<Math.PI/12){a[selectedImage].rotation.y+=.1;metaPlane.rotation.y+=.1;metaData_name.rotation.y+=.1;metaData_date.rotation.y+=.1;metaData_caption.rotation.y+=.1}addRightArrow()}else{if(a[selectedImage].rotation.y>.1){a[selectedImage].rotation.y-=.1;metaPlane.rotation.y-=.1;metaData_name.rotation.y-=.1;metaData_date.rotation.y-=.1;metaData_caption.rotation.y-=.1}removeRightArrow()}else if(mouse.x<w/2-imageSize/3&&mouse.x>w/2-outerBoundary&&!bTextboxActive){if(a[selectedImage].rotation.y>Math.PI-Math.PI/12){a[selectedImage].rotation.y-=.1;metaPlane.rotation.y-=.1;metaData_name.rotation.y-=.1;metaData_date.rotation.y-=.1;metaData_caption.rotation.y-=.1}addLeftArrow()}else{if(a[selectedImage].rotation.y<Math.PI){a[selectedImage].rotation.y+=.1;metaPlane.rotation.y+=.1;metaData_name.rotation.y+=.1;metaData_date.rotation.y+=.1;metaData_caption.rotation.y+=.1}removeLeftArrow()}}console.log(bTextboxActive);window.requestAnimationFrame(q,renderer.domElement);R()}function R(){renderer.autoClear=!1;renderer.clear();renderer.render(scene,camera)}var e=350,t=1e3,n=1,r=-120,i=-120,s=1200,o=0,u=0,a=[];for(var f=0;f<10;f++){var l=Math.random()*4e3-2e3,c=Math.random()*4e3-2e3,p=Math.random()*1,d=Math.random()*(Math.PI/2)-Math.PI/4,v=new THREE.PlaneGeometry(imageSize,imageSize,10,10),m=new THREE.MeshLambertMaterial({color:16777215}),g=THREE.ImageUtils.loadTexture("instagram_img/"+photoLinks[f].link+".jpg"),y=Math.floor(Math.random()*5),b=THREE.ImageUtils.loadTexture("instagram_img/texture_"+y+".jpg"),E=new THREE.MeshPhongMaterial({map:g,bumpMap:b,bumpScale:5}),S=new THREE.Mesh(v,E);S.position.x=l;S.position.y=c;S.position.z=p;S.rotation.z=d;a.push(S)}for(var f=0;f<a.length;f++)scene.add(a[f]);var v=new THREE.PlaneGeometry(7280,3700,10,10),g=THREE.ImageUtils.loadTexture("instagram_img/background_texture_large.jpg"),m=new THREE.MeshPhongMaterial({map:g}),x=new THREE.Mesh(v,m);x.position.z=-1;scene.add(x);document.body.addEventListener("mousemove",function(e){moveInfo.x=e.clientX;moveInfo.y=e.clientY;mouse.x=e.clientX;mouse.y=e.clientY;pickMouse.x=event.clientX/window.innerWidth*2-1;pickMouse.y=-(event.clientY/window.innerHeight)*2+1;if(mouseDown<1)if(e.clientX>w-w*boundaryPct||e.clientX<w*boundaryPct||e.clientY>h-h*boundaryPct||e.clientY<h*boundaryPct)A(e.clientX,e.clientY);else{camSpeedX=0;camSpeedY=0}},!1);window.addEventListener("keypress",function(e){if(e.keyCode==77||e.keyCode==109)bMap=!bMap},!1);container.addEventListener("click",function(e){if(state==0)mouseDownCount<10&&k(INTERSECTED.id);else if(state==1){L(e.clientX,e.clientY);if(e.clientX>w/2+imageSize/3&&e.clientX<w/2+outerBoundary&&bIsFront){B(1);bIsFront=!1;removeRightArrow();addTextContainer();addTextbox();createNotes(photoLinks[selectedImage].link)}if(e.clientX<w/2-imageSize/3&&e.clientX>w/2-outerBoundary&&!bIsFront){B(0);bIsFront=!0;removeLeftArrow();removeTextContainer();clearNotes();textbox.value=""}}},!1);container.addEventListener("mousedown",function(e){++mouseDown;mouseDownCount=0;state==0&&M()},!1);container.addEventListener("mouseup",function(e){--mouseDown},!1);lineLength=function(e,t,n,r){return Math.sqrt((e-=n)*e+(t-=r)*t)};q((new Date).getTime())};