//**********************INSTAGRAM STUFF********************************
var photos=[];window.onload=function(){function Ht(){pt=Jt(M.position.z,1e3,4500,500,2e3);var e=z.position.x,t=z.position.y;while(lineLength(z.position.x,z.position.y,e,t)<pt){e=M.position.x+Math.cos(Math.random()*Math.PI*2)*pt;t=M.position.y+Math.sin(Math.random()*Math.PI*2)*pt}var n=Math.random()*10,i=Math.random()*(Math.PI/2)-Math.PI/4,s=new THREE.PlaneGeometry(r,r,10,10),o=new THREE.MeshLambertMaterial({color:16777215}),u=Math.floor(Math.random()*photoLinks.length),a=THREE.ImageUtils.loadTexture("instagram_img/"+photoLinks[u].link+".jpg"),f=Math.floor(Math.random()*5),l=THREE.ImageUtils.loadTexture("instagram_img/texture_"+f+".jpg"),c=new THREE.MeshPhongMaterial({map:a,bumpMap:l,bumpScale:5}),h=new THREE.Mesh(s,c);h.position.x=e;h.position.y=t;h.position.z=n;h.rotation.z=i;Et.push(h);j.add(Et[Et.length-1])}function Bt(){dt=Jt(M.position.z,1e3,4500,1e3,3e3);for(var e=0;e<Et.length;e++){var t=lineLength(Et[e].position.x,Et[e].position.y,M.position.x,M.position.y);if(t>dt){j.remove(Et[e]);Et.splice(e,1)}}}function jt(){if(bt!=E.x||wt!=E.y){bt=E.x;wt=E.y;yt=Jt(M.position.z,1e3,4500,1200,1400);for(var e=0;e<Et.length;e++){var t=lineLength(Et[e].position.x,Et[e].position.y,z.position.x,z.position.y);if(t<yt&&t>yt/2){var n=Math.floor(Math.random()*31),r=THREE.ImageUtils.loadTexture("img/instagram_"+n+".jpg");Et[e].material.map=r}}}window.setTimeout(jt,2e3)}function Ft(e){for(var t=0;t<Et.length;t++)if(Et[t].id==e){d=t;v.set(Et[t].position.x,Et[t].position.y,Et[t].position.z);Et[t].position.set(M.position.x,M.position.y,M.position.z-800);Et[t].rotation.set(0,0,0);J.position.set(M.position.x,M.position.y,M.position.z-800);et.position.set(M.position.x,M.position.y,M.position.z-799.9);ot.position.set(M.position.x,M.position.y,M.position.z-799.9);ht.position.set(M.position.x,M.position.y,M.position.z-799.9);F.intensity=0;I.intensity=1;I.position.set(M.position.x,M.position.y,1e3);I.target=z;Et[t].material.needsUpdate=!0;n=1;K=photoLinks[d].name;G.save();G.setTransform(1,0,0,1,0,0);G.clearRect(0,0,Q.width,Q.height);G.restore();G.fillText(K,$t(20,30),$t(145,155));Y.needsUpdate=!0;tt=photoLinks[d].time;rt.save();rt.setTransform(1,0,0,1,0,0);rt.clearRect(0,0,nt.width,nt.height);rt.restore();rt.fillText(tt,$t(20,30),$t(110,120));it.needsUpdate=!0;ut=photoLinks[d].caption;var r=ft.measureText(ut),i=r.width;ft.save();ft.setTransform(1,0,0,1,0,0);ft.clearRect(0,0,at.width,at.height);ft.restore();Kt(ft,ut,$t(20,30),$t(220,250),400,32);lt.needsUpdate=!0;addTextbox()}}function It(i,s){if(i<e/2-r/2||i>e/2+r/2||s<t/2-r/2||s>t/2+r/2){n=0;J.rotation.y=Math.PI;et.rotation.y=Math.PI;ot.rotation.y=Math.PI;ht.rotation.y=Math.PI;F.intensity=1;I.intensity=0;Et[d].position.set(v.x,v.y,v.z);Et[d].rotation.set(0,0,Math.random()*(Math.PI/2)-Math.PI/4);selectImage=-1;removeTextbox()}}function qt(n,r){var s=Math.abs(e/2-n),o=Math.abs(t/2-r);n<e*i?H=Jt(s,e*i,e/2,0,-l):n>e-e*i&&(H=Jt(s,e*i,e/2,0,l));r<t*i?B=Jt(o,t*i,t/2,0,l):r>t-t*i&&(B=Jt(o,t*i,t/2,0,-l))}function Rt(){var e=E.x/w*w/2-1,t=-(E.y/b)*b/2+1;y.set(e,t,.5);g.unprojectVector(y,M)}function Ut(){var e=new THREE.Vector3(x.x,x.y,1);T.unprojectVector(e,M);N.set(M.position,e.sub(M.position).normalize());var t=N.intersectObjects(Et);if(t.length>0){S;S=t[0].object}else S=null}function zt(){if(S!=null)for(var e=0;e<Et.length;e++)if(Et[e].id==S.id){Et[e].position.x=z.position.x;Et[e].position.y=z.position.y}}function Wt(){for(var e=0;e<Et.length;e++)if(Et[e].id==S.id){d=e;v.set(Et[e].position.x,Et[e].position.y,Et[e].position.z)}}function Xt(){if(f){var e=Jt(M.position.x,-s,s,0,256)-26,t=Jt(M.position.y,o,-o,0,160)-16;u.style.left=e+"px";u.style.top=t+"px";a.style.right="10px";a.style.bottom="10px"}else{u.style.left="-9999px";u.style.top="-9999px";a.style.right="-9999px";a.style.bottom="-9999px"}}function Vt(e){if(e==0){if(Et[d].rotation.y>=-Math.PI){Et[d].rotation.y-=.3;J.rotation.y-=.3;et.rotation.y-=.3;ot.rotation.y-=.3;ht.rotation.y-=.3}}else if(e==1){if(Et[d].rotation.y<=Math.PI){Et[d].rotation.y+=.3;J.rotation.y+=.3;et.rotation.y+=.3;ot.rotation.y+=.3;ht.rotation.y+=.3}}else if(e==2){if(Et[d].rotation.y<0){Et[d].rotation.y+=.3;J.rotation.y+=.3;et.rotation.y+=.3;ot.rotation.y+=.3;ht.rotation.y+=.3}}else if(e==3){if(Et[d].rotation.y>0){Et[d].rotation.y-=.3;J.rotation.y-=.3;et.rotation.y-=.3;ot.rotation.y-=.3;ht.rotation.y-=.3}}else if(e==4){Et[d].rotation.y=0;J.rotation.y=Math.PI;et.rotation.y=Math.PI;ot.rotation.y=Math.PI;ht.rotation.y=Math.PI}}function $t(e,t){return Math.floor(Math.random()*(t-e+1))+e}function Jt(e,t,n,r,i){return r+(i-r)*(e-t)/(n-t)}function Kt(e,t,n,r,i,s){var o=t.split(" "),u="";for(var a=0;a<o.length;a++){var f=u+o[a]+" ",l=e.measureText(f),c=l.width;if(c>i&&a>0){e.fillText(u,n,r);u=o[a]+" ";r+=s}else u=f}e.fillText(u,n,r)}function Qt(i){M.position.z<1e3&&(M.position.z=1e3);M.position.z>4500&&(M.position.z=4500);if(n==0){if(M.position.x>s-e/2){H=0;M.position.x=s-e/2}if(M.position.x<-s+e/2){H=0;M.position.x=-s+e/2}if(M.position.y>o-t/2){B=0;M.position.y=o-t/2}if(M.position.y<-o+t/2){B=0;M.position.y=-o+t/2}M.position.x+=H;M.position.y+=B;Xt();var u=Jt(M.position.z,1e3,4500,Math.PI/8,Math.PI/40),a=Jt(M.position.z,1e3,4500,75,500);F.angle=u;F.exponent=a;Pt.position.x=M.position.x;Pt.position.y=M.position.y;F.position.set(M.position.x,M.position.y,M.position.z);F.target=z;Rt();if(h){zt();H=0;B=0;F.intensity=1.5;F.angle=Math.PI/4;F.exponent=30;p++}mt=Jt(E.x,0,e,-120,-570);gt=Jt(E.y,0,t,80,-200);z.position.x=y.x-w/2+mt;z.position.y=y.y+b/2+gt;z.position.z=y.z-1e3}else if(n==1){z.position.set(M.position.x,M.position.y,M.position.z-1e3);c.x<e/2-r/3?Vt(0):c.x>e/2+r/3?Vt(1):c.x<e/2?Vt(2):c.x>e/2?Vt(3):Vt(4)}window.requestAnimationFrame(Qt,C.domElement);Gt()}function Gt(){C.autoClear=!1;C.clear();C.render(j,M)}var e=window.innerWidth,t=window.innerHeight,n=0,r=500,i=.25,s=6400,o=3600,u=document.getElementById("user-position"),a=document.getElementById("HUD"),f=!0,l=10,c=new THREE.Vector2,h=0,p=0,d=-1,v=new THREE.Vector3;v.set(0,0,0);var m=new THREE.Ray,g=new THREE.Projector,y=new THREE.Vector3,b=window.innerHeight,w=window.innerWidth,E={x:0,y:0},S,x=new THREE.Vector2,T=new THREE.Projector,N=new THREE.Raycaster,C=new THREE.WebGLRenderer({antialias:!0});C.setSize(e,t);C.setClearColorHex(131586,1);C.clear();document.body.appendChild(C.domElement);var k=45,L=e/t,A=1,O=5e4,M=new THREE.PerspectiveCamera(k,L,A,O);M.position.z=1200;M.position.y=0;M.position.x=0;var _=M.position.x,D=M.position.y,P=M.position.z,H=0,B=0,j=new THREE.Scene,F=new THREE.SpotLight(15261886,1,1e4,Math.PI/4,10);j.add(F);var I=new THREE.SpotLight(15261886,0,1e4,Math.PI/6,18);j.add(I);var q=new THREE.HemisphereLight(16777215,16777215,1),R=new THREE.Geometry(100,100,10,10),U=new THREE.MeshLambertMaterial({color:16711680,transparent:!0}),z=new THREE.Mesh(R,U);j.add(z);C.shadowMapEnabled=!0;F.castShadow=!0;var W=new THREE.PlaneGeometry(r,r,10,10),X=THREE.ImageUtils.loadTexture("instagram_img/paper-back.jpg"),V=THREE.ImageUtils.loadTexture("instagram_img/paper-back-bump.jpg"),$=new THREE.MeshPhongMaterial({map:X,bumpMap:V,bumpScale:1}),J=new THREE.Mesh(W,$);J.rotation.y=Math.PI;j.add(J);var K="Hello, World!",Q=document.createElement("canvas");Q.width=500;Q.height=500;var G=Q.getContext("2d");G.font="36px Font";G.fillStyle="rgba(40,40,40,0.9)";G.fillText(K,0,50);var Y=new THREE.Texture(Q);Y.needsUpdate=!0;var Z=new THREE.MeshPhongMaterial({map:Y});Z.transparent=!0;var et=new THREE.Mesh(new THREE.PlaneGeometry(Q.width,Q.height),Z);et.position.set(0,0,10);et.rotation.y=Math.PI;j.add(et);var tt="Hello, World!",nt=document.createElement("canvas");nt.width=500;nt.height=500;var rt=nt.getContext("2d");rt.font="24px Font";rt.fillStyle="rgba(40,40,40,0.9)";rt.fillText(tt,0,50);var it=new THREE.Texture(nt);it.needsUpdate=!0;var st=new THREE.MeshPhongMaterial({map:it});st.transparent=!0;var ot=new THREE.Mesh(new THREE.PlaneGeometry(nt.width,nt.height),st);ot.position.set(0,0,10);ot.rotation.y=Math.PI;j.add(ot);var ut="Hello, World!",at=document.createElement("canvas");at.width=500;at.height=500;var ft=at.getContext("2d");ft.font="28px Font";ft.fillStyle="rgba(40,40,40,0.9)";ft.fillText(ut,0,50);var lt=new THREE.Texture(at);lt.needsUpdate=!0;var ct=new THREE.MeshPhongMaterial({map:lt});ct.transparent=!0;var ht=new THREE.Mesh(new THREE.PlaneGeometry(at.width,at.height),ct);ht.position.set(0,0,10);ht.rotation.y=Math.PI;j.add(ht);var pt=350,dt=1e3,vt=1,mt=-120,gt=-120,yt=1200,bt=0,wt=0,Et=[];for(var St=0;St<photoLinks.length;St++){var xt=Math.random()*4e3-2e3,Tt=Math.random()*4e3-2e3,Nt=Math.random()*10,Ct=Math.random()*(Math.PI/2)-Math.PI/4,kt=new THREE.PlaneGeometry(r,r,10,10),Lt=new THREE.MeshLambertMaterial({color:16777215}),At=THREE.ImageUtils.loadTexture("instagram_img/"+photoLinks[St].link+".jpg"),Ot=Math.floor(Math.random()*5),Mt=THREE.ImageUtils.loadTexture("instagram_img/texture_"+Ot+".jpg"),_t=new THREE.MeshPhongMaterial({map:At,bumpMap:Mt,bumpScale:5}),Dt=new THREE.Mesh(kt,_t);Dt.position.x=xt;Dt.position.y=Tt;Dt.position.z=Nt;Dt.rotation.z=Ct;Et.push(Dt)}for(var St=0;St<Et.length;St++)j.add(Et[St]);var kt=new THREE.PlaneGeometry(7280,3700,10,10),At=THREE.ImageUtils.loadTexture("instagram_img/background_texture_large.jpg"),Lt=new THREE.MeshPhongMaterial({map:At}),Pt=new THREE.Mesh(kt,Lt);Pt.position.z=-1;j.add(Pt);document.body.addEventListener("mousemove",function(n){E.x=n.clientX;E.y=n.clientY;c.x=n.clientX;c.y=n.clientY;x.x=event.clientX/window.innerWidth*2-1;x.y=-(event.clientY/window.innerHeight)*2+1;if(h<1)if(n.clientX>e-e*i||n.clientX<e*i||n.clientY>t-t*i||n.clientY<t*i)qt(n.clientX,n.clientY);else{H=0;B=0}},!1);window.addEventListener("keypress",function(e){if(e.keyCode==77||e.keyCode==109)f=!f},!1);window.addEventListener("click",function(e){n==0?p<5&&Ft(S.id):n==1&&It(e.clientX,e.clientY)},!1);document.addEventListener("mousedown",function(e){++h;p=0;n==0&&Ut()},!1);document.addEventListener("mouseup",function(e){--h},!1);lineLength=function(e,t,n,r){return Math.sqrt((e-=n)*e+(t-=r)*t)};Qt((new Date).getTime())};