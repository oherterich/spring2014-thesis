var planeList=[],w=window.innerWidth,h=window.innerHeight,state=0,imageSize=500,maxZDepth=30,boundaryPct=.25,outerBoundary=3*imageSize/4,horizBoundary=1920,vertBoundary=1200,boundaryMinVec=new THREE.Vector3(-1920,-1200,0),boundaryMaxVec=new THREE.Vector3(1920,1200,0),camMinVec=new THREE.Vector3(-1920+w/2,-1200+h/2,1200),camMaxVec=new THREE.Vector3(1920-w/2,1200-h/2,12500),HUD=document.getElementById("HUD"),lightHUDSize=45,bMap=!0,panMaxSpeed=10,mouse=new THREE.Vector2,mouseDown=0,mouseDownCount=0,bIsFront=!0,bTextboxActive=!1,bFirstTimeScrollInstruction=!0,bFirstTimeClickInstruction=!0,moveSpeed=.35,bMoveToFront=!1,putBackRotation=Math.random()*(Math.PI/2)-Math.PI/4,bFadeLight=!1,bRotatePic=!1,rotateSpeed=.3,whichRotate=-1,damping=new THREE.Vector3(.55,.55,.55),maxSpeed=new THREE.Vector3(10,10,0),dragState=-1,bIsScrolling=!1,bHUDActive=!1,bHUDDraggable=!1,selectedImage=-1,selectedImagePos=new THREE.Vector3;selectedImagePos.set(0,0,0);var ray=new THREE.Ray,projector=new THREE.Projector,directionVector=new THREE.Vector3,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH=window.innerWidth,moveInfo={x:0,y:0},INTERSECTED,pickMouse=new THREE.Vector2,pickProjector=new THREE.Projector,pickRaycaster=new THREE.Raycaster,renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setSize(w,h),renderer.setClearColorHex(131586,1),renderer.clear();var container=document.getElementById("container");container.appendChild(renderer.domElement);var FOV=45,ASPECT=w/h,NEAR=1,FAR=5e4,camera=new THREE.PerspectiveCamera(FOV,ASPECT,NEAR,FAR);camera.position.z=1200,camera.position.y=0,camera.position.x=0;var prevCamX=camera.position.x,prevCamY=camera.position.y,prevCamZ=camera.position.z,camSpeedX=0,camSpeedY=0,scene=new THREE.Scene,light=new THREE.SpotLight(15261886,1,1e4,Math.PI/6,40);scene.add(light);var clickedLight=new THREE.SpotLight(15261886,0,1e4,Math.PI/4,15);scene.add(clickedLight);var hemiLight=new THREE.HemisphereLight(16777215,16777215,.115);scene.add(hemiLight);var lookAtThisGeom=new THREE.Geometry(100,100,10,10),lookAtThisText=new THREE.MeshLambertMaterial({color:16711680,transparent:!0}),lookAtThis=new THREE.Mesh(lookAtThisGeom,lookAtThisText);scene.add(lookAtThis);var prevLookAtThis=new THREE.Vector3,metaPlaneGeo=new THREE.PlaneGeometry(imageSize,imageSize,10,10),metaPlaneTexture=THREE.ImageUtils.loadTexture("img/paper-back.jpg"),metaPlaneBump=THREE.ImageUtils.loadTexture("img/paper-back-bump.jpg"),metaPlaneMat=new THREE.MeshPhongMaterial({map:metaPlaneTexture,bumpMap:metaPlaneBump,bumpScale:1}),metaPlane=new THREE.Mesh(metaPlaneGeo,metaPlaneMat);metaPlane.rotation.y=Math.PI,scene.add(metaPlane);var metaDataText_name="Hello, World!",metaCanvas_name=document.createElement("canvas");metaCanvas_name.width=500,metaCanvas_name.height=500;var metaContext_name=metaCanvas_name.getContext("2d");metaContext_name.font="36px Font",metaContext_name.fillStyle="rgba(40,40,40,0.9)",metaContext_name.fillText(metaDataText_name,0,50);var metaDataTexture_name=new THREE.Texture(metaCanvas_name);metaDataTexture_name.needsUpdate=!0;var metaDataMat_name=new THREE.MeshPhongMaterial({map:metaDataTexture_name});metaDataMat_name.transparent=!0;var metaData_name=new THREE.Mesh(new THREE.PlaneGeometry(metaCanvas_name.width,metaCanvas_name.height),metaDataMat_name);metaData_name.position.set(0,0,10),metaData_name.rotation.y=Math.PI,scene.add(metaData_name);var metaDataText_date="Hello, World!",metaCanvas_date=document.createElement("canvas");metaCanvas_date.width=500,metaCanvas_date.height=500;var metaContext_date=metaCanvas_date.getContext("2d");metaContext_date.font="24px Font",metaContext_date.fillStyle="rgba(40,40,40,0.9)",metaContext_date.fillText(metaDataText_date,0,50);var metaDataTexture_date=new THREE.Texture(metaCanvas_date);metaDataTexture_date.needsUpdate=!0;var metaDataMat_date=new THREE.MeshPhongMaterial({map:metaDataTexture_date});metaDataMat_date.transparent=!0;var metaData_date=new THREE.Mesh(new THREE.PlaneGeometry(metaCanvas_date.width,metaCanvas_date.height),metaDataMat_date);metaData_date.position.set(0,0,10),metaData_date.rotation.y=Math.PI,scene.add(metaData_date);var metaDataText_caption="Hello, World!",metaCanvas_caption=document.createElement("canvas");metaCanvas_caption.width=500,metaCanvas_caption.height=500;var metaContext_caption=metaCanvas_caption.getContext("2d");metaContext_caption.font="28px Font",metaContext_caption.fillStyle="rgba(40,40,40,0.9)",metaContext_caption.fillText(metaDataText_caption,0,50);var metaDataTexture_caption=new THREE.Texture(metaCanvas_caption);metaDataTexture_caption.needsUpdate=!0;var metaDataMat_caption=new THREE.MeshPhongMaterial({map:metaDataTexture_caption});metaDataMat_caption.transparent=!0;var metaData_caption=new THREE.Mesh(new THREE.PlaneGeometry(metaCanvas_caption.width,metaCanvas_caption.height),metaDataMat_caption);metaData_caption.position.set(0,0,10),metaData_caption.rotation.y=Math.PI,scene.add(metaData_caption),window.onload=function(){function t(t,e,a,o,i,n,s){this.pic=t,this.vel=e,this.acc=a,this.id=o,this.name=i,this.time=n,this.caption=s}function e(){M=L(camera.position.z,1e3,4500,1e3,3e3);for(var t=0;t<planeList.length;t++){var e=x(planeList[t].pic.position.x,planeList[t].pic.position.y,camera.position.x,camera.position.y);e>M&&(scene.remove(planeList[t].pic),planeList.splice(t,1))}}function a(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function o(t){for(var e=0;e<planeList.length;e++)if(planeList[e].pic.id==t){selectedImage=e,selectedImagePos.set(planeList[e].pic.position.x,planeList[e].pic.position.y,planeList[e].pic.position.z),bMoveToFront=!0,metaPlane.position.set(camera.position.x,camera.position.y,camera.position.z-800),metaData_name.position.set(camera.position.x,camera.position.y,camera.position.z-799.9),metaData_date.position.set(camera.position.x,camera.position.y,camera.position.z-799.9),metaData_caption.position.set(camera.position.x,camera.position.y,camera.position.z-799.9),bFadeLight=!0,clickedLight.position.set(camera.position.x,camera.position.y,camera.position.z-200),clickedLight.target=lookAtThis,planeList[e].pic.material.needsUpdate=!0,state=1,metaDataText_name=planeList[selectedImage].name,metaContext_name.save(),metaContext_name.setTransform(1,0,0,1,0,0),metaContext_name.clearRect(0,0,metaCanvas_name.width,metaCanvas_name.height),metaContext_name.restore(),metaContext_name.font=Math.floor(4*Math.random())+24+"px Font",metaContext_name.fillText(metaDataText_name,30,80),metaDataTexture_name.needsUpdate=!0,metaDataText_date=planeList[selectedImage].time,metaContext_date.save(),metaContext_date.setTransform(1,0,0,1,0,0),metaContext_date.clearRect(0,0,metaCanvas_date.width,metaCanvas_date.height),metaContext_date.restore(),metaContext_name.font=Math.floor(2*Math.random())+16+"px Font",metaContext_date.fillText(metaDataText_date,30,50),metaDataTexture_date.needsUpdate=!0,metaDataText_caption=planeList[selectedImage].caption,("n"==metaDataText_caption||""==metaDataText_caption||" "==metaDataText_caption)&&(metaDataText_caption=". . .");for(var a=metaDataText_caption.split(" "),o=0;o<a.length;o++)"#"==a[o][0]?(a.splice(o,1),o--):a[o]=a[o]+" ";metaDataText_caption=a.join("");var i=metaContext_caption.measureText(metaDataText_caption),n=i.width;metaContext_caption.save(),metaContext_caption.setTransform(1,0,0,1,0,0),metaContext_caption.clearRect(0,0,metaCanvas_caption.width,metaCanvas_caption.height),metaContext_caption.restore(),metaContext_caption.font=Math.floor(4*Math.random())+22+"px Font",metaContext_caption.textAlign="center",metaContext_caption.globalCompositeOperation="multiply",_(metaContext_caption,metaDataText_caption,imageSize/2,imageSize/2,400,32),metaDataTexture_caption.needsUpdate=!0,posX=planeList[selectedImage].pic.position.x,posY=planeList[selectedImage].pic.position.y}}function i(t,e){return t>w/2+imageSize/3&&w/2+outerBoundary+imageSize/3>t?void(bIsFront?(bRotatePic=!0,whichRotate=0,bIsFront=!1):(bRotatePic=!0,whichRotate=1,bIsFront=!0)):w/2-imageSize/3>t&&t>w/2-outerBoundary-imageSize/3?void(bIsFront?(bRotatePic=!0,whichRotate=2,bIsFront=!1):(bRotatePic=!0,whichRotate=3,bIsFront=!0)):(state=0,metaPlane.rotation.y=Math.PI,metaData_name.rotation.y=Math.PI,metaData_date.rotation.y=Math.PI,metaData_caption.rotation.y=Math.PI,bFadeLight=!0,planeList[selectedImage].pic.rotation.x=0,planeList[selectedImage].pic.rotation.y=0,bMoveToFront=!0,putBackRotation=Math.random()*(Math.PI/2)-Math.PI/4,maxZDepth+=1,bIsFront=!0,bFirstTimeScrollInstruction&&(addInstruction(2),bFirstTimeScrollInstruction=!1),void 0)}function n(t,e){var a=Math.abs(w/2-t),o=Math.abs(h/2-e);w*boundaryPct>t&&camera.position.x>=-horizBoundary+w/2?camSpeedX=L(a,w*boundaryPct,w/2,0,-panMaxSpeed):t>w-w*boundaryPct&&camera.position.x<=horizBoundary-w/2&&(camSpeedX=L(a,w*boundaryPct,w/2,0,panMaxSpeed)),h*boundaryPct>e&&camera.position.y>=-vertBoundary+h/2?camSpeedY=L(o,h*boundaryPct,h/2,0,panMaxSpeed):e>h-h*boundaryPct&&camera.position.y<=vertBoundary-h/2&&(camSpeedY=L(o,h*boundaryPct,h/2,0,-panMaxSpeed))}function s(){var t=new THREE.Vector3(mouse.x/window.innerWidth*2-1,2*-(mouse.y/window.innerHeight)+1,.5);projector.unprojectVector(t,camera);var e=t.sub(camera.position).normalize(),a=-camera.position.z/e.z,o=camera.position.clone().add(e.multiplyScalar(a));directionVector.x=o.x,directionVector.y=o.y,directionVector.z=o.z}function r(){var t=new THREE.Vector3(pickMouse.x,pickMouse.y,1);pickProjector.unprojectVector(t,camera),pickRaycaster.set(camera.position,t.sub(camera.position).normalize());var e=pickRaycaster.intersectObjects(scene.children);if(e.length>0){INTERSECTED=e[0].object,addAutoCursor();for(var a=0;a<planeList.length;a++)if(planeList[a].pic.id==INTERSECTED.id){var o=x(lookAtThis.position.x,lookAtThis.position.y,planeList[a].pic.position.x,planeList[a].pic.position.y);imageSize/2>o?(dragState=0,addTranslateCursor()):(dragState=1,d(a))}}else INTERSECTED=null}function p(){if(null!=INTERSECTED)for(var t=0;t<planeList.length;t++)if(planeList[t].pic.id==INTERSECTED.id){var e=x(lookAtThis.position.x,lookAtThis.position.y,planeList[t].pic.position.x,planeList[t].pic.position.y);if(imageSize/2>e&&0==dragState){addTranslateCursor();var a=new THREE.Vector3(lookAtThis.position.x-prevLookAtThis.x,lookAtThis.position.y-prevLookAtThis.y);planeList[t].pic.position.x+=a.x,planeList[t].pic.position.y+=a.y,planeList[t].vel=a.divide(new THREE.Vector3(4,4,4)),planeList[t].vel.clamp(new THREE.Vector3(-10,-10,-10),new THREE.Vector3(10,10,10))}else if(1==dragState){var o=Math.atan2(lookAtThis.position.y-planeList[t].pic.position.y,lookAtThis.position.x-planeList[t].pic.position.x),i=Math.atan2(prevLookAtThis.y-planeList[t].pic.position.y,prevLookAtThis.x-planeList[t].pic.position.x),n=o-i;planeList[t].pic.rotation.z+=n,d(t)}}}function c(){for(var t=0;t<planeList.length;t++)planeList[t].pic.id==INTERSECTED.id&&(selectedImage=t,selectedImagePos.set(planeList[t].pic.position.x,planeList[t].pic.position.y,planeList[t].pic.position.z))}function m(){if(bMap){var t=L(camera.position.x,-horizBoundary,horizBoundary,-lightHUDSize/2,256+lightHUDSize/2)-lightHUDSize/2,e=L(camera.position.y,vertBoundary,-vertBoundary,0,160)-lightHUDSize/2;userPosition.style.left=t+"px",userPosition.style.top=e+"px"}else userPosition.style.left="-9999px",userPosition.style.top="-9999px",HUD.style.right="-9999px",HUD.style.bottom="-9999px"}function l(){("TEXTAREA"==document.activeElement.nodeName||"INPUT"==document.activeElement.nodeName)&&(bTextboxActive=!0)}function d(t){lookAtThis.position.x<planeList[t].pic.position.x&&lookAtThis.position.y>=planeList[t].pic.position.y?addRotateTopCursor():lookAtThis.position.x>planeList[t].pic.position.x&&lookAtThis.position.y>=planeList[t].pic.position.y?addRotateRightCursor():lookAtThis.position.x>planeList[t].pic.position.x&&lookAtThis.position.y<planeList[t].pic.position.y?addRotateBottomCursor():lookAtThis.position.x<planeList[t].pic.position.x&&lookAtThis.position.y<planeList[t].pic.position.y&&addRotateLeftCursor()}function y(){bIsFront?mouse.x>w/2+imageSize/3&&mouse.x<w/2+outerBoundary+imageSize/3?(planeList[selectedImage].pic.rotation.y<Math.PI/12&&(planeList[selectedImage].pic.rotation.y+=.1,metaPlane.rotation.y+=.1,metaData_name.rotation.y+=.1,metaData_date.rotation.y+=.1,metaData_caption.rotation.y+=.1),addRotateCursor()):mouse.x<w/2-imageSize/3&&mouse.x>w/2-outerBoundary-imageSize/3?(planeList[selectedImage].pic.rotation.y>-Math.PI/12&&(planeList[selectedImage].pic.rotation.y-=.1,metaPlane.rotation.y-=.1,metaData_name.rotation.y-=.1,metaData_date.rotation.y-=.1,metaData_caption.rotation.y-=.1),addRotateCursor()):(planeList[selectedImage].pic.rotation.y>.1?(planeList[selectedImage].pic.rotation.y-=.1,metaPlane.rotation.y-=.1,metaData_name.rotation.y-=.1,metaData_date.rotation.y-=.1,metaData_caption.rotation.y-=.1):planeList[selectedImage].pic.rotation.y<0&&(planeList[selectedImage].pic.rotation.y+=.1,metaPlane.rotation.y+=.1,metaData_name.rotation.y+=.1,metaData_date.rotation.y+=.1,metaData_caption.rotation.y+=.1),addAutoCursor()):mouse.x>w/2+imageSize/2&&mouse.x<w/2+outerBoundary+imageSize/3?(planeList[selectedImage].pic.rotation.y<Math.PI+Math.PI/12&&planeList[selectedImage].pic.rotation.y>0?(planeList[selectedImage].pic.rotation.y+=.1,metaPlane.rotation.y+=.1,metaData_name.rotation.y+=.1,metaData_date.rotation.y+=.1,metaData_caption.rotation.y+=.1):planeList[selectedImage].pic.rotation.y<-Math.PI+Math.PI/12&&planeList[selectedImage].pic.rotation.y<0&&(planeList[selectedImage].pic.rotation.y+=.1,metaPlane.rotation.y+=.1,metaData_name.rotation.y+=.1,metaData_date.rotation.y+=.1,metaData_caption.rotation.y+=.1),addRotateCursor()):mouse.x<w/2-imageSize/2&&mouse.x>w/2-outerBoundary-imageSize/3?(planeList[selectedImage].pic.rotation.y>Math.PI-Math.PI/12&&planeList[selectedImage].pic.rotation.y>0?(planeList[selectedImage].pic.rotation.y-=.1,metaPlane.rotation.y-=.1,metaData_name.rotation.y-=.1,metaData_date.rotation.y-=.1,metaData_caption.rotation.y-=.1):planeList[selectedImage].pic.rotation.y>-Math.PI-Math.PI/12&&planeList[selectedImage].pic.rotation.y<0&&(planeList[selectedImage].pic.rotation.y-=.1,metaPlane.rotation.y-=.1,metaData_name.rotation.y-=.1,metaData_date.rotation.y-=.1,metaData_caption.rotation.y-=.1),addRotateCursor()):(planeList[selectedImage].pic.rotation.y>Math.PI?(planeList[selectedImage].pic.rotation.y-=.1,metaPlane.rotation.y-=.1,metaData_name.rotation.y-=.1,metaData_date.rotation.y-=.1,metaData_caption.rotation.y-=.1):planeList[selectedImage].pic.rotation.y<Math.PI-.1&&planeList[selectedImage].pic.rotation.y>0&&(planeList[selectedImage].pic.rotation.y+=.1,metaPlane.rotation.y+=.1,metaData_name.rotation.y+=.1,metaData_date.rotation.y+=.1,metaData_caption.rotation.y+=.1),planeList[selectedImage].pic.rotation.y<-Math.PI?(planeList[selectedImage].pic.rotation.y+=.1,metaPlane.rotation.y+=.1,metaData_name.rotation.y+=.1,metaData_date.rotation.y+=.1,metaData_caption.rotation.y+=.1):planeList[selectedImage].pic.rotation.y>-Math.PI+.1&&planeList[selectedImage].pic.rotation.y<0&&(planeList[selectedImage].pic.rotation.y-=.1,metaPlane.rotation.y-=.1,metaData_name.rotation.y-=.1,metaData_date.rotation.y-=.1,metaData_caption.rotation.y-=.1),addAutoCursor())}function u(t,e,a,o){var i=x(planeList[selectedImage].pic.position.x,planeList[selectedImage].pic.position.y,t,e);i>.01&&bMoveToFront?(planeList[selectedImage].pic.position.x=moveSpeed*t+(1-moveSpeed)*planeList[selectedImage].pic.position.x,planeList[selectedImage].pic.position.y=moveSpeed*e+(1-moveSpeed)*planeList[selectedImage].pic.position.y,planeList[selectedImage].pic.position.z=moveSpeed*a+(1-moveSpeed)*planeList[selectedImage].pic.position.z,planeList[selectedImage].pic.rotation.z=moveSpeed*o+(1-moveSpeed)*planeList[selectedImage].pic.rotation.z):bMoveToFront=!1}function T(t,e){Math.abs(planeList[selectedImage].pic.rotation.y-e)>.01&&bRotatePic?(planeList[selectedImage].pic.rotation.y=t*e+(1-t)*planeList[selectedImage].pic.rotation.y,metaPlane.rotation.y=t*(e+Math.PI)+(1-t)*metaPlane.rotation.y,metaData_name.rotation.y=t*(e+Math.PI)+(1-t)*metaData_name.rotation.y,metaData_date.rotation.y=t*(e+Math.PI)+(1-t)*metaData_date.rotation.y,metaData_caption.rotation.y=t*(e+Math.PI)+(1-t)*metaData_caption.rotation.y):(bRotatePic=!1,whichRotate=-1)}function g(t,e,a){Math.abs(t.intensity-a)>.001&&bFadeLight?t.intensity=e*a+(1-e)*t.intensity:bFadeLight=!1}function x(t,e,a,o){return Math.sqrt((t-=a)*t+(e-=o)*e)}function E(t,e){return Math.floor(Math.random()*(e-t+1))+t}function L(t,e,a,o,i){return o+(i-o)*(t-e)/(a-e)}function _(t,e,a,o,i,n){for(var s=e.split(" "),r="",p=0;p<s.length;p++){var c=r+s[p]+" ",m=t.measureText(c),l=m.width;l>i&&p>0?(t.fillText(r,a,o),r=s[p]+" ",o+=n):r=c}t.fillText(r,a,o)}function v(t){if(0==state){camera.position.clamp(camMinVec,camMaxVec),bIsScrolling||s(),bIsScrolling=!1,r(),bHUDActive&&(camSpeedX=0,camSpeedY=0),camera.position.x+=camSpeedX,camera.position.y+=camSpeedY,m();var e=L(camera.position.z,1e3,4500,Math.PI/8,Math.PI/40),a=L(camera.position.z,1e3,4500,75,500);light.angle=e,light.exponent=a,light.position.set(camera.position.x,camera.position.y,camera.position.z),light.target=lookAtThis,-1!=selectedImage&&(u(selectedImagePos.x,selectedImagePos.y,maxZDepth,putBackRotation),g(light,.1,1),g(clickedLight,.1,0));for(var o=0;o<planeList.length;o++)planeList[o].vel.x+=planeList[o].acc.x,planeList[o].vel.y+=planeList[o].acc.y,planeList[o].pic.position.x+=planeList[o].vel.x,planeList[o].pic.position.y+=planeList[o].vel.y,planeList[o].acc.set(0,0,0),planeList[o].vel.multiply(damping);mouseDown&&(p(),camSpeedX=0,camSpeedY=0,light.intensity=1.5,light.angle=Math.PI/4,light.exponent=30,mouseDownCount++),prevLookAtThis.x=lookAtThis.position.x,prevLookAtThis.y=lookAtThis.position.y,prevLookAtThis.z=lookAtThis.position.z,lookAtThis.position.x=directionVector.x,lookAtThis.position.y=directionVector.y,lookAtThis.position.z=directionVector.z,lookAtThis.position.clamp(boundaryMinVec,boundaryMaxVec)}else 1==state&&(lookAtThis.position.set(camera.position.x,camera.position.y,camera.position.z-1e3),u(camera.position.x,camera.position.y,camera.position.z-800,0),g(light,.02,0),g(clickedLight,.02,1),l(),0==whichRotate&&T(rotateSpeed,Math.PI),1==whichRotate&&T(rotateSpeed,0),2==whichRotate&&T(rotateSpeed,-Math.PI),3==whichRotate&&T(rotateSpeed,0),bRotatePic||y());window.requestAnimationFrame(v,renderer.domElement),D()}function D(){renderer.autoClear=!1,renderer.clear(),renderer.render(scene,camera)}for(var I=350,M=1e3,R=1,P=1200,C=0,S=0,k=0;k<photoLinks[0].length;k++){var H=1*photoLinks[0][k].posX,b=1*photoLinks[0][k].posY,f=1*photoLinks[0][k].posZ,z=1*photoLinks[0][k].rot,A=new THREE.PlaneGeometry(imageSize,imageSize,1,1),V="default_img/"+photoLinks[0][k].link+".jpg",F;if(F=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),F.open("GET",V,!1),F.send(),404!=F.status){var X=THREE.ImageUtils.loadTexture(V),U=new THREE.MeshPhongMaterial({map:X}),B=new THREE.Mesh(A,U);B.position.x=H,B.position.y=b,B.position.z=f,B.rotation.z=z;var j=new THREE.Vector3(0,0,0),Y=new THREE.Vector3(0,0,0),G=photoLinks[0][k].link,N=photoLinks[0][k].name,W=photoLinks[0][k].time,q=photoLinks[0][k].caption;planeList.push(new t(B,j,Y,G,N,W,q)),scene.add(B)}}for(var k=0;k<photoLinks[1].length;k++){var H=1*photoLinks[1][k].posX,b=1*photoLinks[1][k].posY,f=1*photoLinks[1][k].posZ,z=1*photoLinks[1][k].rot,A=new THREE.PlaneGeometry(imageSize,imageSize,1,1),V="instagram_img/"+photoLinks[1][k].link+".jpg",F;if(F=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),F.open("GET",V,!1),F.send(),404!=F.status){var X=THREE.ImageUtils.loadTexture(V),U=new THREE.MeshPhongMaterial({map:X}),B=new THREE.Mesh(A,U);B.position.x=H,B.position.y=b,B.position.z=f,B.rotation.z=z;var j=new THREE.Vector3(0,0,0),Y=new THREE.Vector3(0,0,0),G=photoLinks[1][k].link,N=photoLinks[1][k].name,W=photoLinks[1][k].time,q=photoLinks[1][k].caption;planeList.push(new t(B,j,Y,G,N,W,q)),scene.add(B)}}var A=new THREE.PlaneGeometry(4800,3e3,10,10),X=THREE.ImageUtils.loadTexture("img/background_texture_1920.jpg"),O=new THREE.MeshPhongMaterial({map:X}),Z=new THREE.Mesh(A,O);Z.position.z=-1,scene.add(Z),document.body.addEventListener("mousemove",function(t){t.preventDefault(),moveInfo.x=t.clientX,moveInfo.y=t.clientY,mouse.x=t.clientX,mouse.y=t.clientY,pickMouse.x=t.clientX/window.innerWidth*2-1,pickMouse.y=2*-(t.clientY/window.innerHeight)+1,1>mouseDown&&(t.clientX>w-w*boundaryPct||t.clientX<w*boundaryPct||t.clientY>h-h*boundaryPct||t.clientY<h*boundaryPct?n(t.clientX,t.clientY):(camSpeedX=0,camSpeedY=0)),instruction[0].style.opacity>0&&(instruction[0].style.opacity-=.01,instruction[0].style.opacity<=.01&&(instruction[0].style.opacity=0,removeInstruction(0),bFirstTimeClickInstruction&&addInstruction(1)))},!1),window.addEventListener("keypress",function(t){(77==t.keyCode||109==t.keyCode)&&(bMap=!bMap)},!1),container.addEventListener("click",function(t){t.preventDefault(),0==state?10>mouseDownCount&&(o(INTERSECTED.id),removeInstruction(0),removeInstruction(1),bFirstTimeClickInstruction=!1):1==state&&i(t.clientX,t.clientY)},!1),container.addEventListener("mousedown",function(t){t.preventDefault(),++mouseDown,mouseDownCount=0,0==state&&r()},!1),container.addEventListener("mouseup",function(t){t.preventDefault(),--mouseDown,mouseDown=0,dragState=-1,addAutoCursor(),bHUDDraggable=!1},!1),window.addEventListener("mouseup",function(t){mouseDown=0}),container.addEventListener("mousewheel",function(t){if(bIsScrolling=!0,0==state){var e=L(t.wheelDeltaY,-500,500,-50,50);camera.position.z+=e,instruction[2].style.opacity>0&&(instruction[2].style.opacity-=.03,instruction[2].style.opacity<=.01&&(instruction[2].style.opacity=0,removeInstruction(2)))}console.log(lookAtThis.position.x+" | "+lookAtThis.position.y+" | "+lookAtThis.position.z)}),window.addEventListener("resize",a,!1),v((new Date).getTime())};